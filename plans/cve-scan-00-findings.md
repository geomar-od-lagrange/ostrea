# CVE Scan Findings

Scanned on 2026-02-10. Filter: HIGH and CRITICAL only.
Tools: trivy (aquasec/trivy:latest) for Alpine/Ubuntu, grype (anchore/grype:latest) for Fedora.

## Overview

| Image | Base | HIGH | CRITICAL | Notes |
| --- | --- | --- | --- | --- |
| ostrea-frontend | Alpine 3.23 | 0 | 0 | Clean |
| ostrea-db | Fedora 41 | 0 | 0 | Clean (grype; trivy does not support Fedora) |
| ostrea-api | Node 22 Alpine | 10 | 0 | npm: glob, tar |
| ostrea-db-init | Ubuntu 24.04 (miniforge) | 8 | 0 | OS + base image Python deps |

## ostrea-frontend

Clean. No HIGH or CRITICAL vulnerabilities.

## ostrea-db

Trivy does not support Fedora OS scanning. Re-scanned with grype:

```
docker run --rm anchore/grype:latest quay.io/willirath/ostrea:ostrea-db-latest --only-fixed -f high
```

Result: **No vulnerabilities found.** Clean.

## ostrea-api

10 HIGH, 0 CRITICAL. All from npm dependencies.

### glob

| Field | Value |
| --- | --- |
| CVE | CVE-2025-64756 |
| Severity | HIGH |
| Installed | 10.4.5 |
| Fixed | 10.5.0 or 11.1.0 |
| Title | Command Injection via Malicious Filenames |
| Link | https://avd.aquasec.com/nvd/cve-2025-64756 |

### tar (version 6.2.1)

| Field | Value |
| --- | --- |
| CVE | CVE-2026-23745 |
| Severity | HIGH |
| Installed | 6.2.1 |
| Fixed | 7.5.3 |
| Title | Arbitrary file overwrite and symlink poisoning via unsanitized linkpaths |
| Link | https://avd.aquasec.com/nvd/cve-2026-23745 |

| Field | Value |
| --- | --- |
| CVE | CVE-2026-23950 |
| Severity | HIGH |
| Installed | 6.2.1 |
| Fixed | 7.5.4 |
| Title | Arbitrary file overwrite via Unicode path collision race condition |
| Link | https://avd.aquasec.com/nvd/cve-2026-23950 |

| Field | Value |
| --- | --- |
| CVE | CVE-2026-24842 |
| Severity | HIGH |
| Installed | 6.2.1 |
| Fixed | 7.5.7 |
| Title | Arbitrary file creation via path traversal bypass in hardlink |
| Link | https://avd.aquasec.com/nvd/cve-2026-24842 |

### tar (version 7.4.3)

Same 3 CVEs as above (two versions of tar are installed).
Fixed version: 7.5.7.

### Suggested fix

```bash
cd api && npm audit fix
```

Or pin in package.json:
- `glob` >= 10.5.0
- `tar` >= 7.5.7

## ostrea-db-init

8 HIGH, 0 CRITICAL. All from OS package or base image (conda/pip) transitive deps.
None of our direct pip install packages are affected.

### gpgv (OS)

| Field | Value |
| --- | --- |
| CVE | CVE-2025-68973 |
| Severity | HIGH |
| Installed | 2.4.4-2ubuntu17.3 |
| Fixed | 2.4.4-2ubuntu17.4 |
| Title | GnuPG: Information disclosure and potential arbitrary code execution via out-of-bounds write |
| Link | https://avd.aquasec.com/nvd/cve-2025-68973 |

### Brotli (base image conda)

| Field | Value |
| --- | --- |
| CVE | CVE-2025-6176 |
| Severity | HIGH |
| Installed | 1.1.0 |
| Fixed | 1.2.0 |
| Title | Python brotli decompression bomb DoS |
| Link | https://avd.aquasec.com/nvd/cve-2025-6176 |

### urllib3 (base image conda)

| Field | Value |
| --- | --- |
| CVE | CVE-2025-66418 |
| Severity | HIGH |
| Installed | 2.4.0 |
| Fixed | 2.6.0 |
| Title | Unbounded decompression chain leads to resource exhaustion |
| Link | https://avd.aquasec.com/nvd/cve-2025-66418 |

| Field | Value |
| --- | --- |
| CVE | CVE-2025-66471 |
| Severity | HIGH |
| Installed | 2.4.0 |
| Fixed | 2.6.0 |
| Title | Streaming API improperly handles highly compressed data |
| Link | https://avd.aquasec.com/nvd/cve-2025-66471 |

| Field | Value |
| --- | --- |
| CVE | CVE-2026-21441 |
| Severity | HIGH |
| Installed | 2.4.0 |
| Fixed | 2.6.3 |
| Title | Decompression-bomb safeguard bypass when following HTTP redirects (streaming) |
| Link | https://avd.aquasec.com/nvd/cve-2026-21441 |

### jaraco.context (setuptools vendored)

| Field | Value |
| --- | --- |
| CVE | CVE-2026-23949 |
| Severity | HIGH |
| Installed | 5.3.0 |
| Fixed | 6.1.0 |
| Title | Path traversal via malicious tar archives |
| Link | https://avd.aquasec.com/nvd/cve-2026-23949 |

### wheel (setuptools vendored)

| Field | Value |
| --- | --- |
| CVE | CVE-2026-24049 |
| Severity | HIGH |
| Installed | 0.45.1 |
| Fixed | 0.46.2 |
| Title | Privilege Escalation or Arbitrary Code Execution via malicious wheel file |
| Link | https://avd.aquasec.com/nvd/cve-2026-24049 |

### Root cause

All 8 vulns come from the base image (`condaforge/miniforge3:25.3.0-3`), not our code.
The miniforge image ships conda, requests, urllib3, Brotli, setuptools, wheel — none of
which are needed at runtime. Our code only needs pip and the packages we install.

Dependency chain:
- urllib3 <- requests <- conda (base image tooling, not used at runtime)
- Brotli <- nothing (orphan from base image)
- wheel, setuptools, jaraco.context <- base image build tooling
- gpgv <- Ubuntu OS package in miniforge base

### Suggested fix: switch to slim Python base

Replace `condaforge/miniforge3:25.3.0-3` with `python:3.12-slim`. This eliminates
all conda/miniforge baggage (urllib3, Brotli, wheel, setuptools, gpgv) and only ships
what we pip-install.

```dockerfile
FROM python:3.12-slim

WORKDIR /app

RUN pip install --no-cache-dir \
    psycopg2-binary \
    geoalchemy2 \
    geopandas \
    pandas \
    pyarrow \
    pyyaml \
    sqlalchemy \
    tqdm

COPY data/ ./data/
COPY src/ ./src/
COPY pyproject.toml ./
RUN pip install --no-cache-dir -e .
COPY init/init_db.py ./

RUN useradd -r -u 1000 appuser && chown -R 1000:1000 /app
USER 1000

CMD ["python", "init_db.py"]
```

This should eliminate all 7 Python CVEs (they're all base image bloat).
The gpgv CVE may also disappear since python:3.12-slim uses Debian, not Ubuntu.

Verify by re-scanning after rebuild.

## Fixes applied

### db-init: base image switch

Switched `database/init/Dockerfile` from `condaforge/miniforge3:25.3.0-3` to `python:3.12.12-slim`.

Result: all 7 Python CVEs eliminated. 2 remaining (libc-bin/libc6 CVE-2026-0861) are
unfixable — pending glibc upstream fix in Debian 13, no patched version available.

### api: multi-stage build, strip npm

All 10 vulns (glob, tar) were in npm's own bundled deps at `/usr/local/lib/node_modules/npm/`,
not in our app's node_modules. npm is not needed at runtime.

Multi-stage `api/Dockerfile`: build stage runs `npm ci`, runtime stage copies only
`node_modules` and removes npm/npx from the node base image.

Result: 0 vulnerabilities.

## Final scan results (after fixes)

| Image | HIGH | CRITICAL | Notes |
| --- | --- | --- | --- |
| ostrea-frontend | 0 | 0 | Clean |
| ostrea-db | 0 | 0 | Clean (grype) |
| ostrea-api | 0 | 0 | Clean (npm stripped) |
| ostrea-db-init | 2 | 0 | libc-bin/libc6 only, no fix available upstream |

### docs: image-building.md build context fix

Fixed db-init build context from `database/init/` to `-f database/init/Dockerfile database/`
(matching docker-compose). The Dockerfile's COPY paths are relative to `database/`, not `database/init/`.

### stale artifact: database/requirements.txt

`database/requirements.txt` is a conda-generated freeze from the miniforge era. It contains
`@ file:///Users/runner/miniforge3/...` paths and is not used by the new `python:3.12-slim`
Dockerfile. Safe to delete.

## YOUR QUESTIONS/NOTES:

-
